<?xml version="1.0" encoding="utf-8" ?>
<Page x:Class="ClassPlanner.Views.GenerateTimetablingViewPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="using:ClassPlanner.Controls"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:ext="using:ClassPlanner.Extensions"
      xmlns:local="using:ClassPlanner.Views"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:models="using:ClassPlanner.Models"
      xmlns:tableView="using:WinUI.TableView"
      xmlns:timetabling="using:ClassPlanner.Timetabling"
      mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <CommandBar VerticalContentAlignment="Stretch" DefaultLabelPosition="Right">
            <CommandBar.Content>
                <Grid>
                    <TextBlock Margin="12,0"
                               VerticalAlignment="Center"
                               FontSize="18"
                               FontWeight="Bold"
                               Text="Gerar grade de horários" />
                </Grid>
            </CommandBar.Content>

            <AppBarToggleButton x:Name="optionsButton"
                                Icon="Setting"
                                IsChecked="{x:Bind OptionsTeachingTip.IsOpen, Mode=TwoWay}"
                                Label="Opções">
                <AppBarToggleButton.Resources>
                    <TeachingTip x:Name="OptionsTeachingTip"
                                 IsLightDismissEnabled="True"
                                 Target="{x:Bind optionsButton}">
                        <TeachingTip.Content>
                            <StackPanel>
                                <NumberBox Header="Aulas por dia"
                                           Maximum="10"
                                           Minimum="1"
                                           PlaceholderText="Digite a quantidade de aulas por semana"
                                           SpinButtonPlacementMode="Inline"
                                           Value="{x:Bind ViewModel.PeriodPerDay, Mode=TwoWay}" />

                                <MenuFlyoutSeparator Margin="0,4" />

                                <TextBlock FontWeight="Bold" Text="Restrições fortes" />

                                <CheckBox Content="Todas as disciplinas devem ser alocadas para um horário"
                                          IsChecked="True"
                                          IsEnabled="False" />

                                <CheckBox Content="Toda aula deve ser alocada em um horário disponível"
                                          IsChecked="True"
                                          IsEnabled="False" />

                                <CheckBox Content="Um professor deve ser alocado para uma única turma por período"
                                          IsChecked="True"
                                          IsEnabled="False" />

                                <MenuFlyoutSeparator Margin="0,4" />

                                <TextBlock FontWeight="Bold" Text="Restrições leves" />

                                <CheckBox Content="Evitar mais de duas aulas da mesma disciplina por dia" IsChecked="{x:Bind ViewModel.ExcessDailyClassesConstraintIsEnabled, Mode=TwoWay}" />

                                <CheckBox Content="Preferir que uma disciplina tenha duas aulas consecutivas no mesmo dia" IsChecked="{x:Bind ViewModel.ConsecutiveClassesRewardConstraintIsEnabled, Mode=TwoWay}" />

                                <MenuFlyoutSeparator Margin="0,4" />

                                <TextBlock FontWeight="Bold" Text="Configurações" />

                                <Slider Maximum="64"
                                        Minimum="1"
                                        StepFrequency="4"
                                        TickFrequency="4"
                                        TickPlacement="Outside"
                                        Value="{x:Bind ViewModel.MaxThreads, Mode=TwoWay}">
                                    <Slider.Header>
                                        <TextBlock>
                                            <Run Text="Quantidade de processos paralelos" />
                                        </TextBlock>
                                    </Slider.Header>
                                </Slider>

                                <Grid ColumnSpacing="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>

                                    <FontIcon HorizontalAlignment="Left"
                                              VerticalAlignment="Center"
                                              FontSize="14"
                                              Glyph="&#xF167;" />

                                    <TextBlock Grid.Column="1"
                                               FontSize="12"
                                               Opacity="0.7"
                                               Text="Mais processos consomem mais memória, mas podem encontrar soluções mais rapidamente."
                                               TextWrapping="Wrap" />
                                </Grid>



                            </StackPanel>
                        </TeachingTip.Content>
                    </TeachingTip>
                </AppBarToggleButton.Resources>
            </AppBarToggleButton>

            <AppBarButton Command="{x:Bind ViewModel.GenerateTimetablingCommand}"
                          Icon="Play"
                          Label="Iniciar" />

            <AppBarButton Click="{x:Bind ViewModel.GenerateTimetablingCommand.Cancel}"
                          Icon="Stop"
                          IsEnabled="{x:Bind ViewModel.GenerateTimetablingCommand.CanBeCanceled, Mode=OneWay}"
                          Label="Parar de buscar" />
        </CommandBar>

        <Rectangle Grid.Row="1"
                   Height="1"
                   VerticalAlignment="Bottom"
                   Fill="{ThemeResource NavigationViewItemSeparatorForeground}" />

        <ProgressBar Grid.Row="1"
                     VerticalAlignment="Top"
                     Background="Transparent"
                     IsIndeterminate="{x:Bind ViewModel.GenerateTimetablingCommand.IsRunning, Mode=OneWay}" />

        <InfoBar x:Name="infoBar"
                 Title="{x:Bind TimetableResultTitle(ViewModel.Result), Mode=OneWay}"
                 Grid.Row="1"
                 CornerRadius="0"
                 IsOpen="{x:Bind ViewModel.GenerateTimetablingCommand.ExecutionTask.IsCompletedSuccessfully, Mode=OneWay}"
                 Message="{x:Bind TimetableResultMessage(ViewModel.Result), Mode=OneWay}"
                 Severity="{x:Bind TimetableResultSeverity(ViewModel.Result), Mode=OneWay}" />

        <Grid Grid.Row="2">
            <Grid.Transitions>
                <TransitionCollection>
                    <RepositionThemeTransition />
                </TransitionCollection>
            </Grid.Transitions>
            <SplitView DisplayMode="CompactInline"
                       IsPaneOpen="True"
                       OpenPaneLength="60"
                       PaneBackground="{ThemeResource LayerOnAcrylicFillColorDefault}">
                <SplitView.Pane>
                    <Grid>
                        <ListView x:Name="lista" ItemsSource="{x:Bind ViewModel.Timetables}">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="timetabling:Timetable">
                                    <Border Width="30"
                                            Padding="2"
                                            HorizontalAlignment="Left"
                                            Background="{ThemeResource AccentAAFillColorDefaultBrush}"
                                            BorderThickness="2"
                                            CornerRadius="4"
                                            ToolTipService.ToolTip="Valor objetivo do timetabling (quanto maior, melhor)">
                                        <TextBlock Foreground="{ThemeResource SystemAltHighColor}"
                                                   Text="{x:Bind ObjectiveValue}"
                                                   TextAlignment="Center" />
                                    </Border>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </SplitView.Pane>
                <SplitView.Content>
                    <Grid BorderBrush="{ThemeResource NavigationViewItemSeparatorForeground}"
                          BorderThickness="1,0,0,0"
                          DataContext="{x:Bind lista.SelectedItem, Mode=OneWay}">

                        <ScrollView Grid.Row="0">
                            <ItemsRepeater ItemsSource="{Binding ClassSchedules}">
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="models:ClassSchedule">
                                        <Grid Padding="8" RowSpacing="4">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="25" />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>

                                            <TextBlock FontSize="16"
                                                       Text="{x:Bind Classroom.Name}"
                                                       TextAlignment="Center" />

                                            <controls:ScheduleView Grid.Row="1"
                                                                   HorizontalAlignment="Center"
                                                                   ClassSchedule="{x:Bind}" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </ScrollView>
                    </Grid>
                </SplitView.Content>
            </SplitView>
        </Grid>
    </Grid>
</Page>
